# .github/workflows/schedule.yml
name: â° Schedule Data Extraction

on:
  # FutÃ¡si Ã¼tem 15 percenkÃ©nt
  schedule:
    - cron: "*/15 * * * *" 
  workflow_dispatch:

jobs:
  extract_and_deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout Source (main)
      - name: â¬‡ï¸ Checkout Source (main)
        uses: actions/checkout@v4
        with:
          ref: main 
          token: ${{ secrets.GITHUB_TOKEN }} 

      # 2. Setup Node
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # -----------------------------------------------------------------
      # NEW STEP 2a: Install Chromium and libraries for ChromeDriver/Selenium
      # -----------------------------------------------------------------
      - name: ğŸŒ Install Browser Dependencies (for Selenium)
        run: |
          sudo apt-get update
      # -----------------------------------------------------------------

      # 3. Install Dependencies
      - name: âš™ï¸ Install dependencies
        run: npm install

      # 3a Folder creation
      - name: ğŸ“ Ensure public directory exists
        run: mkdir -p public Â  Â  Â  Â 
        
      # 4. RUN EXTRACTOR 
      - name: ğŸš€ Run Data Extractor
        run: npm run scrape # 

      # 5. Commit and Push (Final Fix)
      - name: ğŸ”„ Commit and Push Updated Files to gh-pages
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: 'public/dashboard.html public/parking-status.json'
          commit_message: "chore: Automatic data update [skip ci]"
          branch: gh-pages
          skip_checkout: true