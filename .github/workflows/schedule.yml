name: ‚è∞ Schedule Data Extraction

on:
  workflow_dispatch:
  schedule:
    - cron: "*/15 * * * *" 
push:                   # <--- EZ AZ √öJ R√âSZ
    branches:
      - main              # Lefut minden push-n√°l a main-re

jobs:
  extract_and_deploy:
    runs-on: ubuntu-latest
    permissions: 
      contents: write
      pages: write
      id-token: write
    steps:
      - name: ‚¨áÔ∏è Checkout Main Branch
        uses: actions/checkout@v4
        with:
          ref: main

      - name: üì¶ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ‚öôÔ∏è Install dependencies
        run: npm install

      - name: üìÅ Prepare Public Folder
        run: mkdir -p public 

      - name: üöÄ Run Data Extractor
        run: node extractor.js

      - name: üèóÔ∏è Build HTML and Copy Assets
        run: |
          # 1. Gener√°ljuk le az index.html-t (a builder.js-nek a public/index.html-be kell √≠rnia)
          node builder.js
          
          # 2. M√°soljuk √°t a kritikus f√°jlokat a main-r≈ël a public-ba
          cp style.css public/
          cp script.js public/
          
          # 3. Ikonok √©s egy√©b eszk√∂z√∂k m√°sol√°sa
          mkdir -p public/icons
          cp -r icons/* public/icons/ 2>/dev/null || true
          cp favicon.ico public/ 2>/dev/null || true

      - name: üöÄ Deploy to GH Pages (Clean State)
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public 
          publish_branch: gh-pages
          force_orphan: true  # Ez kitakar√≠tja a r√©gi szemetet a gh-pages √°gr√≥l
          commit_message: "chore(data): Automated update with all assets [skip ci]"